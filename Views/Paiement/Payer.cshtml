@model brasilBurger.Models.PaiementVM
@{
    ViewData["Title"] = "Paiement";
    Layout = "_Layout";
}

<div class="container py-5">
    <div class="row">
        <!-- Colonne gauche : Résumé -->
        <div class="col-lg-4 mb-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <h5 class="fw-bold mb-4">
                        <i class="fas fa-receipt me-2 text-primary"></i>
                        Résumé de la commande
                    </h5>
                    
                    <div class="mb-3">
                        <p class="text-muted mb-1">Produit</p>
                        <p class="fw-bold">@Model.NomProduit</p>
                    </div>
                    
                    <div class="mb-3">
                        <p class="text-muted mb-1">Type</p>
                        <span class="badge @(Model.Type == "Burger" ? "badge-vert" : "badge-bleu")">
                            @Model.Type
                        </span>
                    </div>
                    
                    <div class="mb-3">
                        <p class="text-muted mb-1">Quantité</p>
                        <p class="fw-bold">@Model.Quantite</p>
                    </div>
                    
                    @if (Model.Complements != null && Model.Complements.Any())
                    {
                        <div class="mb-3">
                            <p class="text-muted mb-1">Compléments</p>
                            <ul class="list-unstyled mb-0">
                                @foreach(var comp in Model.Complements)
                                {
                                    <li class="d-flex justify-content-between align-items-center mb-2">
                                        <span>@comp.Nom</span>
                                        <span class="text-muted">@comp.Prix.ToString("N0") FCFA</span>
                                    </li>
                                }
                            </ul>
                        </div>
                    }
                    
                    <hr>
                    
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Total</h5>
                        <h4 class="text-success fw-bold mb-0">@Model.Total.ToString("N0") FCFA</h4>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Colonne droite : Formulaire de paiement -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <h4 class="fw-bold mb-4">
                        <i class="fas fa-credit-card me-2 text-primary"></i>
                        Informations de paiement
                    </h4>
                    
                    <form asp-action="TraiterPaiement" asp-controller="Paiement" method="post">
                        @Html.AntiForgeryToken()
                        
                        <!-- Champs cachés -->
                        <input type="hidden" name="ProduitId" value="@Model.ProduitId" />
                        <input type="hidden" name="Type" value="@Model.Type" />
                        <input type="hidden" name="Quantite" value="@Model.Quantite" />
                        
                        @if (Model.ComplementIds != null && Model.ComplementIds.Any())
                        {
                            @foreach(var compId in Model.ComplementIds)
                            {
                                <input type="hidden" name="SelectedComplements" value="@compId" />
                            }
                        }
                        
                        <!-- Téléphone -->
                        <div class="mb-4">
                            <label class="form-label fw-medium">
                                <i class="fas fa-phone me-2"></i>Numéro de téléphone
                            </label>
                            <input type="tel" name="Telephone" class="form-control" 
                                   value="@ViewBag.Client?.Telephone" 
                                   placeholder="77 123 45 67" required>
                            <small class="text-muted">Le numéro pour le paiement mobile</small>
                        </div>
                        
                        <!-- Type de commande -->
                        <div class="mb-4">
                            <label class="form-label fw-medium">
                                <i class="fas fa-shopping-bag me-2"></i>Type de commande
                            </label>
                            <select class="form-select" name="TypeCmd" id="typeCmdSelect" required>
                                <option value="">Choisir le type de commande</option>
                                <option value="SUR_PLACE">Sur place</option>
                                <option value="A_RECUPERER">À récupérer</option>
                                <option value="LIVRAISON">Livraison</option>
                            </select>
                        </div>
                        
                        <!-- Zone de livraison (caché par défaut) -->
                        <div class="mb-4" id="zoneSelectContainer" style="display:none;">
                            <label class="form-label fw-medium">
                                <i class="fas fa-map-marker-alt me-2"></i>Zone de livraison
                            </label>
                            <select class="form-select" name="ZoneId" id="zoneSelect">
                                <option value="">Choisir une zone</option>
                                @if (ViewBag.Zones != null)
                                {
                                    @foreach(var zone in ViewBag.Zones)
                                    {
                                        <option value="@zone.Id">
                                            @zone.Nom - @zone.PrixLivraison.ToString("N0") FCFA
                                        </option>
                                    }
                                }
                            </select>
                        </div>
                        
                        <!-- Mode de paiement -->
                        <div class="mb-4">
                            <label class="form-label fw-medium">
                                <i class="fas fa-wallet me-2"></i>Mode de paiement
                            </label>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="card border-2 payment-option">
                                        <div class="card-body">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" 
                                                       name="ModePaie" id="wave" value="WAVE" required>
                                                <label class="form-check-label w-100" for="wave">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-mobile-alt fa-2x text-primary me-3"></i>
                                                        <div>
                                                            <strong>Wave</strong>
                                                            <p class="text-muted small mb-0">Paiement mobile</p>
                                                        </div>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card border-2 payment-option">
                                        <div class="card-body">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" 
                                                       name="ModePaie" id="omoney" value="OM">
                                                <label class="form-check-label w-100" for="omoney">
                                                    <div class="d-flex align-items-center">
                                                        <i class="fas fa-mobile-alt fa-2x text-warning me-3"></i>
                                                        <div>
                                                            <strong>Orange Money</strong>
                                                            <p class="text-muted small mb-0">Paiement mobile</p>
                                                        </div>
                                                    </div>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Boutons -->
                        <div class="d-flex gap-3">
                            <button type="submit" class="btn btn-orange btn-lg flex-grow-1">
                                <i class="fas fa-lock me-2"></i>
                                Payer maintenant
                            </button>
                            <a asp-controller="Catalogue" asp-action="Details" 
                               asp-route-id="@Model.ProduitId" asp-route-type="@Model.Type"
                               class="btn btn-outline-secondary btn-lg">
                                <i class="fas fa-arrow-left"></i>
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Informations de sécurité -->
            <div class="card border-0 bg-light mt-4">
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-4">
                            <i class="fas fa-shield-alt fa-2x text-success mb-2"></i>
                            <p class="mb-0 small">Paiement 100% sécurisé</p>
                        </div>
                        <div class="col-md-4">
                            <i class="fas fa-truck fa-2x text-primary mb-2"></i>
                            <p class="mb-0 small">Livraison rapide</p>
                        </div>
                        <div class="col-md-4">
                            <i class="fas fa-headset fa-2x text-info mb-2"></i>
                            <p class="mb-0 small">Support 7j/7</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<script>
    const typeCmdSelect = document.getElementById('typeCmdSelect');
    const zoneContainer = document.getElementById('zoneSelectContainer');
    const zoneSelect = document.getElementById('zoneSelect');

    typeCmdSelect.addEventListener('change', function() {
        if (this.value === "LIVRAISON") { 
            zoneContainer.style.display = "block";
            zoneSelect.required = true;
        } else {
            zoneContainer.style.display = "none";
            zoneSelect.required = false;
            zoneSelect.value = "";
        }
    });
    
    // Style pour les options de paiement
    document.querySelectorAll('.payment-option').forEach(card => {
        card.addEventListener('click', function() {
            const radio = this.querySelector('input[type="radio"]');
            radio.checked = true;
            
            document.querySelectorAll('.payment-option').forEach(c => {
                c.classList.remove('border-primary');
            });
            this.classList.add('border-primary');
        });
    });
</script>
}

<style>
.payment-option {
    cursor: pointer;
    transition: all 0.3s;
}

.payment-option:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.payment-option .form-check-input:checked ~ .form-check-label {
    color: var(--bs-primary);
}
</style>